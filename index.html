<html>

<head>
    <title>transformers-js</title>
    <style>
        textarea { padding: 0.25em 0.25em; }
        #input { font-family: Papyrus, sans-serif; font-size: 32px; margin-bottom: 1em; }
        #output { font-family: monospace; font-size: 32px; }
    </style>
</head>

<body>
    <h1>transformers-js</h1>
    <nav>
        <p><a href="/test">Test Tokenizers</a></p>
    </nav>

    <form style="width:50em;display:block;" onsubmit="translateInput(event)">
        <h2><label for="prefix">Prompt:</label></h2>
        <p><input type="text" id="prefix" value="translate English to French:" style="width: 100%;" /></p>
        <textarea id="input" name="input" rows="3" style="width: 100%;" oninput="translateInput(event)">The universe is a dark forest.</textarea>
        <h2><label for="output">Output:</label></h2>
        <textarea id="output" name="output" rows="4" style="width: 100%;">The universe is a dark forest.</textarea>
        <p id="debug"></p>
        <p><input type="submit" value="Generate"></p>
    </form>

    <script src="src/tokenizers.js"></script>
    <script src="src/transformers.js"></script>
    <script type="text/javascript">

        const $input = document.getElementById("input");
        const $output = document.getElementById("output");
        const $debug = document.getElementById("debug");

        let tokenizer = null;
        let model = null;

        function translateInput(e) {
            if (e) e.preventDefault();
            if (!tokenizer) return;
            if (!model) return;
            const input = $input.value;
            const inputTokens = tokenizer.encode(input);
            console.log("TRANSLATE", inputTokens);
            $debug.innerText = inputTokens.join(" ");
            $output.value = tokenizer.decode(inputTokens);
        }

        async function main() {
            tokenizer = await AutoTokenizer.fromPretrained("t5-small", "/models");
            console.log(tokenizer);
            model = await AutoModelForSeq2SeqLM.fromPretrained("t5-small", "/models");
            console.log(model);
            translateInput(null);
        }

        main();

    </script>
</body>

</html>